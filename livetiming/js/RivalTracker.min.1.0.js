(function(){var e=0;var t=["webkit","moz"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n){window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame)window.requestAnimationFrame=function(t,n){var r=(new Date).getTime();var i=Math.max(0,16-(r-e));var s=window.setTimeout(function(){t(r+i)},i);e=r+i;return s};if(!window.cancelAnimationFrame)window.cancelAnimationFrame=function(e){clearTimeout(e)}})();var RivalTracker=function(){RivalTracker=function(e,t,n,r){function C(){var e=document.createElementNS("http://www.w3.org/2000/svg","g");e.setAttribute("id","RivalTrackerLogo");e.setAttribute("transform",RivalTracker.paths[t].transform);e.addEventListener("mousedown",function(){window.open("http://racingrivals.samiad.co.uk/","_blank")},false);var n;for(var i in RivalTracker.paths["logo"].rival){n=document.createElementNS("http://www.w3.org/2000/svg","path");if(i==0){n.setAttribute("id","dot");h["dot"]=n}n.setAttribute("d",RivalTracker.paths["logo"].rival[i]);n.setAttribute("fill",r.pathColor);e.appendChild(n)}for(var i in RivalTracker.paths["logo"].tracker){n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d",RivalTracker.paths["logo"].tracker[i]);n.setAttribute("fill",r.pathColor);e.appendChild(n)}var s=document.createElementNS("http://www.w3.org/2000/svg","text");s.setAttribute("x",322);s.setAttribute("y",230);s.setAttribute("text-anchor","middle");s.setAttribute("font-family",'Calibri, Candara, Segoe, "Segoe UI", Optima, Arial, sans-serif');s.setAttribute("fill",r.pathColor);s.setAttribute("font-weight","normal");s.setAttribute("font-size","18");s.textContent=RivalTracker.paths[t].name;e.appendChild(s);N.svg.appendChild(e)}function k(e){s[e]=i[e];var t=A(s[e]);circle=h[e];if(circle===undefined){var n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("id",e+"Node");n.setAttribute("cx",t.x);n.setAttribute("cy",t.y);n.setAttribute("r",r.nodeSize);n.setAttribute("fill",_());n.setAttribute("stroke",r.nodeStrokeColor);n.setAttribute("stroke-width",r.nodeStrokeWidth);if(typeof r.callback==="function"){n.addEventListener("mousedown",r.callback,false)}N.svg.appendChild(n);h[e]=n;var o=document.createElementNS("http://www.w3.org/2000/svg","text");if(typeof r.callback==="function"){o.addEventListener("mousedown",r.callback,false)}o.setAttribute("id",e+"Label");o.setAttribute("x",t.x);o.setAttribute("y",t.y+r.nodeSize/4-r.labelVertOffset);o.setAttribute("fill",r.labelColor);o.setAttribute("font-family",r.labelFont);o.setAttribute("font-size",r.labelFontSize);o.setAttribute("font-weight","bolder");o.setAttribute("stroke-width",r.labelStrokeWidth);o.setAttribute("stroke",r.labelStrokeColor);o.setAttribute("text-anchor","middle");o.textContent=e;N.svg.appendChild(o);p[e]=o}else{circle.setAttribute("display","inline");circle.setAttribute("cx",t.x);circle.setAttribute("cy",t.y);o=p[e];o.setAttribute("display","inline");o.setAttribute("x",t.x);o.setAttribute("y",t.y+r.nodeSize/4-r.labelVertOffset)}}function L(e){circle=h[e];driverLabel=p[e];circle.setAttribute("display","none");driverLabel.setAttribute("display","none")}function A(e){if(e===0){e+=1e-4}return d.getPointAtLength(v/100*e)}function O(){var e={};for(var t in n){e[t]=n[t]}return e}function M(){var e="0123456789ABCDEF".split("");var t="#";for(var n=0;n<6;n++){t+=e[Math.round(Math.random()*15)]}return t}function _(){if(T.length<1){return M()}else{return T.shift()}}function H(){if(l<-50){u=f}else{u=a}j=false;if(P){return}D=m.shift();if(D==undefined){return}P=true;D.expires=Date.now()+D.duration;if(r.maxPrediction>0)D.expires-=17;i=D.data;for(var e in s){if(i[e]===undefined){L(e);delete s[e]}}var t;for(var e in i){if(s[e]===undefined){k(e)}t=i[e]-s[e];if(t<-20)t+=100;if(t>90)t-=100;o[e]=t/D.duration}}function F(e){if(!r.reportBufferStatus)return;if(e===E)return;h["dot"].setAttribute("fill",e);E=e}var i=O();var s=O();var o={};var u=.8;var a=.8;var f=.3;var l=0;var c=0;var h={};var p={};var d;var v;var m=new Array;var g=true;var y=200;var b=Date.now();var w=document.getElementById(e);var E="#000000";var S=false;var x=0;var T=["#000066","#00FFFF","#0000FF","#80FF00","#808080","#00FF00","#A02820","#FF00FF","#008000","#800000","#000080","#808000","#FFA000","#800080","#FF0000","#C0C0C0","#008080","#F080F0","#FF0066","#CC3366","#996666","#669966","#33CC66","#00FF66","#FFCCCC","#CCCCCC","#99CCCC","#66CCCC","#33CCCC","#00FFCC","#330066","#9900FF","#6699FF","#6666CC","#996633","#330000","#330033","#990066"];if(RivalTracker.paths[t]==undefined)t="defaultMap";if(typeof r==="undefined"){var r={scaling:100,maxPrediction:8e3,initialBuffer:500,pathColor:"#000000",pathStrokeWidth:6,nodeSize:15,nodeStrokeWidth:2,nodeStrokeColor:"#000000",labelFont:"Arial",labelFontSize:"11px",labelStrokeWidth:2,labelStrokeColor:"#000000",labelColor:"#FFFFFF",labelVertOffset:0,reportBufferStatus:true}}else{r.scaling=typeof r.scaling==="undefined"?"100":r.scaling;r.maxPrediction=typeof r.maxPrediction==="undefined"?8e3:r.maxPrediction;r.initialBuffer=typeof r.initialBuffer==="undefined"?500:r.initialBuffer;r.pathColor=typeof r.pathColor==="undefined"?"#000000":r.pathColor;r.pathStrokeWidth=typeof r.pathStrokeWidth==="undefined"?6:r.pathStrokeWidth;r.nodeSize=typeof r.nodeSize==="undefined"?15:r.nodeSize;r.nodeStrokeWidth=typeof r.nodeStrokeWidth==="undefined"?2:r.nodeStrokeWidth;r.nodeStrokeColor=typeof r.nodeStrokeColor==="undefined"?"#000000":r.nodeStrokeColor;r.labelFont=typeof r.labelFont==="undefined"?"Arial":r.labelFont;r.labelFontSize=typeof r.labelFontSize==="undefined"?"11px":r.labelFontSize;r.labelStrokeWidth=typeof r.labelStrokeWidth==="undefined"?0:r.labelStrokeWidth;r.labelStrokeColor=typeof r.labelStrokeColor==="undefined"?"#ffffff":r.labelStrokeColor;r.labelColor=typeof r.labelColor==="undefined"?"#ffffff":r.labelColor;r.labelVertOffset=typeof r.labelVertOffset==="undefined"?0:r.labelVertOffset;r.reportBufferStatus=typeof r.reportBufferStatus==="undefined"?true:r.reportBufferStatus}var N=this;this.svg=function(){var e="http://www.w3.org/2000/svg";var n=document.createElementNS(e,"svg");n.setAttribute("width","100%");var i=w.clientWidth===0?document.documentElement.clientWidth:w.clientWidth;n.setAttribute("width",i*r.scaling/100);var s=i*(RivalTracker.paths[t].height/100);s=s*r.scaling/100;n.setAttribute("height",s);n.setAttribute("preserveAspectRatio","xMinYMin slice");n.setAttribute("viewBox",RivalTracker.paths[t].viewBox);n.setAttribute("wmode","transparent");return n}();(function(){var n;for(var i in RivalTracker.paths[t].paths){n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d",RivalTracker.paths[t].paths[i]);n.setAttribute("stroke-miterlimit","4");n.setAttribute("stroke-width",r.pathStrokeWidth);n.setAttribute("stroke-dasharray","none");n.setAttribute("stroke",r.pathColor);n.setAttribute("fill","none");if(i==0){n.setAttribute("id","trackPath");n.setAttribute("stroke-opacity","1");d=n}else{n.setAttribute("stroke-opacity","0.2")}N.svg.appendChild(n);v=d.getTotalLength()}var s=A(0);var o=A(.1);var u=document.createElementNS("http://www.w3.org/2000/svg","line");u.setAttribute("x1",s.x);u.setAttribute("y1",s.y-15);u.setAttribute("x2",s.x);u.setAttribute("y2",s.y+15);var a=s.x-o.x;var f=s.y-o.y;var l=Math.atan(f/a)*(180/Math.PI);var c="rotate("+l+" "+s.x+" "+s.y+")";u.setAttribute("transform",c);u.setAttribute("stroke-width",r.pathStrokeWidth);u.setAttribute("stroke",r.pathColor);N.svg.appendChild(u);C()})();(function(){document.getElementById(e).appendChild(N.svg)})();(function(){for(var t in i){if(i.hasOwnProperty(t)){k(t)}}})();this.updatePositions=function(){var e=O();var t=Date.now();var n;if(S){i=O();b=t;S=false;g=true;x=0;return}var s=t-b;if(s<y){return}if(g){s+=r.initialBuffer;g=false}if(c>0){var o=t-c;n=s-o+17;c=0}else{n=s}l=x;if(x<0){n+=x;x=0}if(n<=0)n=1;m.push({data:e,duration:n});x+=n;b=t;H()};var D;var P=false;var B;var j=false;(function I(){requestAnimationFrame(I);var e=Date.now();var t=e-(B||e);B=e;if(D==undefined){return}x-=t;if(e>=D.expires){P=false;if(m.length>0){H()}else{j=true;F("#FFCC00");if(e>=D.expires+r.maxPrediction){j=false;D=undefined;c=e;F("#FF0000");return}}}if(!j)F("#00FF00");for(var n in i){circle=h[n];driverLabel=p[n];if(typeof o[n]=="undefined")continue;var a=o[n]*t;if(j){if(a<0){continue}else{a*=u}}if(f===0)continue;var f=s[n]+a;if(f>100)f-=100;if(f<0)f+=100;var l=A(f);circle.setAttribute("cx",l.x);circle.setAttribute("cy",l.y);driverLabel.setAttribute("x",l.x);driverLabel.setAttribute("y",l.y+r.nodeSize/4-r.labelVertOffset);s[n]=f}})();this.setNodeColor=function(e,t){h[e].setAttribute("fill",t)};this.setNodeStrokeColor=function(e,t){h[e].setAttribute("stroke",t)};this.setNodeStrokeWidth=function(e,t){h[e].setAttribute("stroke-width",t)};this.setNodeStrokeDash=function(e){h[e].setAttribute("stroke-dasharray","3,4")};this.setLabelColor=function(e,t){p[e].setAttribute("fill",t)};this.resetBuffer=function(){S=true;F("#FF0000")}};return RivalTracker}()